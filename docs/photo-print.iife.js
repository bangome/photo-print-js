var PhotoPrintJS=function(h){"use strict";var Q=Object.defineProperty;var ee=(h,v,f)=>v in h?Q(h,v,{enumerable:!0,configurable:!0,writable:!0,value:f}):h[v]=f;var u=(h,v,f)=>ee(h,typeof v!="symbol"?v+"":v,f);function v(c="img"){const e=Date.now().toString(36),t=Math.random().toString(36).substring(2,8);return`${c}_${e}_${t}`}function f(c,e=96){return c/25.4*e}function U(c,e=96){return c/e*25.4}function W(c,e=96){return c*e}function H(c,e=96){return c/e}function j(c){return c/25.4}function G(c){return c*25.4}function Y(c,e,t){return Math.min(Math.max(c,e),t)}function I(c,...e){if(!e.length)return c;const t=e.shift();if(t===void 0)return c;if(R(c)&&R(t)){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const n=t[i];R(n)?(c[i]||Object.assign(c,{[i]:{}}),I(c[i],n)):Object.assign(c,{[i]:n})}}return I(c,...e)}function R(c){return c!==null&&typeof c=="object"&&!Array.isArray(c)}function q(c,e){let t=null;return function(...i){t&&clearTimeout(t),t=setTimeout(()=>{c(...i)},e)}}function V(c,e){let t=!1;return function(...i){t||(c(...i),t=!0,setTimeout(()=>{t=!1},e))}}function X(){return typeof window<"u"&&typeof document<"u"}function z(c){return typeof c=="string"?document.querySelector(c):c}function Z(c,e,t){const i=document.createElement(c);if(e)for(const[n,r]of Object.entries(e))i.setAttribute(n,r);return t&&Object.assign(i.style,t),i}class O{constructor(){u(this,"images",new Map)}async loadImage(e){const t=this.normalizeSource(e),i=t.id||v(),n=await this.createImageElement(t),r={id:i,source:t,element:n,width:n.naturalWidth,height:n.naturalHeight,aspectRatio:n.naturalWidth/n.naturalHeight,caption:t.caption};return this.images.set(i,r),r}async loadImages(e){return await Promise.all(e.map(i=>this.loadImage(i)))}getImage(e){return this.images.get(e)}getAllImages(){return Array.from(this.images.values())}removeImage(e){const t=this.images.get(e);return t?(t.element.src="",this.images.delete(e),!0):!1}clearImages(){this.images.forEach(e=>{e.element.src=""}),this.images.clear()}reorderImages(e,t){const i=this.getAllImages();if(e<0||e>=i.length||t<0||t>=i.length)throw new Error("Invalid index for reordering");const[n]=i.splice(e,1);i.splice(t,0,n),this.images.clear(),i.forEach(r=>{this.images.set(r.id,r)})}updateImageSettings(e,t){const i=this.images.get(e);i&&(i.settings={...i.settings,...t})}get count(){return this.images.size}normalizeSource(e){return typeof e=="string"?e.startsWith("data:")?{type:"base64",data:e}:{type:"url",data:e}:e}async createImageElement(e){return new Promise((t,i)=>{const n=new Image;switch(n.onload=()=>t(n),n.onerror=()=>i(new Error(`Failed to load image: ${this.getSourceDescription(e)}`)),e.type){case"url":const r=e.data;r.startsWith("blob:")||(n.crossOrigin="anonymous"),n.src=r;break;case"base64":n.src=e.data;break;case"file":this.loadFromFile(e.data).then(a=>{n.src=a}).catch(i);break;case"blob":this.loadFromBlob(e.data).then(a=>{n.src=a}).catch(i);break;case"element":const o=e.data;o.complete&&o.naturalWidth>0?n.src=o.src:(o.onload=()=>{n.src=o.src},o.onerror=()=>i(new Error("Source image element failed to load")));break;default:i(new Error(`Unsupported image source type: ${e.type}`))}})}loadFromFile(e){return new Promise((t,i)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>i(new Error("Failed to read file")),n.readAsDataURL(e)})}loadFromBlob(e){return new Promise((t,i)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>i(new Error("Failed to read blob")),n.readAsDataURL(e)})}getSourceDescription(e){switch(e.type){case"url":return e.data;case"file":return e.data.name;case"base64":return"base64 data";case"blob":return"blob data";case"element":return"HTMLImageElement";default:return"unknown source"}}async resizeImage(e,t,i){const n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("Failed to get canvas context");let{width:o,height:a}=e;const s=Math.min(t/o,i/a,1);return o=Math.round(o*s),a=Math.round(a*s),n.width=o,n.height=a,r.drawImage(e.element,0,0,o,a),n}async getImageAsDataURL(e,t="image/png",i=.92){const n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("Failed to get canvas context");return n.width=e.width,n.height=e.height,r.drawImage(e.element,0,0),n.toDataURL(t,i)}}class A{constructor(){u(this,"customLayouts",new Map)}calculateCells(e){const{layout:t,paper:i}=e,n=i.width-i.margins.left-i.margins.right,r=i.height-i.margins.top-i.margins.bottom;return t.cells&&t.cells.length>0?this.calculateCustomCells(t.cells,t,n,r,i.margins):this.calculateGridCells(t,n,r,i.margins)}calculateGridCells(e,t,i,n){const{cols:r,rows:o}=e.grid,a=e.gap||0,s=a*(r-1),l=a*(o-1),g=t-s,d=i-l;let p=g/r,m=d/o;e.aspectRatio&&(p/m>e.aspectRatio?p=m*e.aspectRatio:m=p/e.aspectRatio);const y=p*r+s,w=m*o+l,P=(t-y)/2,x=(i-w)/2,S=[];let L=0;for(let b=0;b<o;b++)for(let k=0;k<r;k++){const J=n.left+P+k*(p+a),K=n.top+x+b*(m+a);S.push({index:L,x:J,y:K,width:p,height:m}),L++}return S}calculateCustomCells(e,t,i,n,r){const{cols:o,rows:a}=t.grid,s=t.gap||0,l=s*(o-1),g=s*(a-1),d=(i-l)/o,p=(n-g)/a;return e.map((m,y)=>{const w=m.colSpan||1,P=m.rowSpan||1,x=r.left+m.x*(d+s),S=r.top+m.y*(p+s),L=d*w+s*(w-1),b=p*P+s*(P-1);return{index:y,x,y:S,width:L,height:b}})}calculatePages(e,t,i){const n=this.calculateCells({layout:t,paper:i}),r=n.length,o=[];if(e.length===0)return[{index:0,imageCount:0,cells:n,images:[]}];const a=Math.ceil(e.length/r);for(let s=0;s<a;s++){const l=s*r,g=Math.min(l+r,e.length),d=e.slice(l,g),p=n.map((m,y)=>{var w;return{...m,imageId:(w=d[y])==null?void 0:w.id}});o.push({index:s,imageCount:d.length,cells:p,images:d})}return o}registerLayout(e){this.customLayouts.set(e.id,e)}getCustomLayout(e){return this.customLayouts.get(e)}getCustomLayouts(){return Array.from(this.customLayouts.values())}removeCustomLayout(e){return this.customLayouts.delete(e)}calculateImageFit(e,t,i,n){const r=e.aspectRatio,o=t.width/t.height;let a,s;switch(i){case"contain":r>o?(a=t.width,s=t.width/r):(s=t.height,a=t.height*r);break;case"cover":r>o?(s=t.height,a=t.height*r):(a=t.width,s=t.width/r);break;case"fill":a=t.width,s=t.height;break;case"none":default:a=e.width,s=e.height;break}let l=t.x,g=t.y;switch(n.horizontal){case"left":l=t.x;break;case"center":l=t.x+(t.width-a)/2;break;case"right":l=t.x+t.width-a;break}switch(n.vertical){case"top":g=t.y;break;case"center":g=t.y+(t.height-s)/2;break;case"bottom":g=t.y+t.height-s;break}return{x:l,y:g,width:a,height:s}}determineOrientation(e,t,i){if(e.orientation&&e.orientation!=="auto")return e.orientation;const{cols:n,rows:r}=e.grid;return n>r?"landscape":(r>n,"portrait")}}class ${constructor(){u(this,"layoutEngine");u(this,"container",null);u(this,"printStyleElement",null);this.layoutEngine=new A}render(e,t,i={}){const{scale:n=1,showPageBorder:r=!0,showCellBorder:o=!1,theme:a="light"}=i,s=document.createElement("div");s.className="photo-print-container",s.setAttribute("data-theme",a);const l=t.dpi||96,g=f(t.paper.width,l)*n,d=f(t.paper.height,l)*n;return Object.assign(s.style,{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",padding:"20px",backgroundColor:a==="dark"?"#1a1a1a":"#f5f5f5"}),e.forEach((p,m)=>{const y=this.renderPage(p,t,{scale:n,showPageBorder:r,showCellBorder:o,pageWidthPx:g,pageHeightPx:d,dpi:l});y.setAttribute("data-page-index",String(m)),s.appendChild(y)}),this.container=s,s}renderPage(e,t,i){const n=document.createElement("div");return n.className="photo-print-page",Object.assign(n.style,{width:`${i.pageWidthPx}px`,height:`${i.pageHeightPx}px`,backgroundColor:"#ffffff",position:"relative",boxShadow:i.showPageBorder?"0 2px 10px rgba(0,0,0,0.2)":"none",overflow:"hidden"}),e.cells.forEach((r,o)=>{const a=e.images[o],s=this.renderCell(r,a,t.imageSettings,i);n.appendChild(s)}),n}renderCell(e,t,i,n){const{scale:r,showCellBorder:o,dpi:a}=n,s=document.createElement("div");s.className="photo-print-cell";const l=f(e.x,a)*r,g=f(e.y,a)*r,d=f(e.width,a)*r,p=f(e.height,a)*r;if(Object.assign(s.style,{position:"absolute",left:`${l}px`,top:`${g}px`,width:`${d}px`,height:`${p}px`,overflow:"hidden",border:o?"1px dashed #ccc":"none",boxSizing:"border-box"}),t){const m=this.renderImage(t,e,i,{scale:r,dpi:a});s.appendChild(m)}return s}renderImage(e,t,i,n){const{scale:r,dpi:o}=n,a={...i,...e.settings};this.layoutEngine.calculateImageFit(e,t,a.fit,a.position);const s=document.createElement("div");s.className="photo-print-image-container";const l=f(t.width,o)*r,g=f(t.height,o)*r;Object.assign(s.style,{position:"absolute",left:"0",top:"0",width:`${l}px`,height:`${g}px`,display:"flex",alignItems:this.getFlexAlign(a.position.vertical),justifyContent:this.getFlexJustify(a.position.horizontal),overflow:"hidden"});const d=document.createElement("img");d.src=e.element.src,d.className="photo-print-image",d.draggable=!1;const p={contain:"contain",cover:"cover",fill:"fill",none:"none"};return Object.assign(d.style,{display:"block",objectFit:p[a.fit],width:a.fit==="none"?"auto":"100%",height:a.fit==="none"?"auto":"100%",transform:a.rotation?`rotate(${a.rotation}deg)`:"none",filter:a.filter||"none"}),s.appendChild(d),s}getFlexAlign(e){return{top:"flex-start",center:"center",bottom:"flex-end"}[e]}getFlexJustify(e){return{left:"flex-start",center:"center",right:"flex-end"}[e]}generatePrintStyles(e){const{paper:t}=e;return`
      @media print {
        @page {
          size: ${t.width}mm ${t.height}mm;
          margin: 0;
        }

        body {
          margin: 0;
          padding: 0;
        }

        .photo-print-container {
          padding: 0 !important;
          background: none !important;
          gap: 0 !important;
        }

        .photo-print-page {
          width: ${t.width}mm !important;
          height: ${t.height}mm !important;
          page-break-after: always;
          box-shadow: none !important;
          transform: none !important;
        }

        .photo-print-page:last-child {
          page-break-after: auto;
        }

        .photo-print-cell {
          border: none !important;
        }
      }
    `}injectPrintStyles(e){this.removePrintStyles(),this.printStyleElement=document.createElement("style"),this.printStyleElement.id="photo-print-styles",this.printStyleElement.textContent=this.generatePrintStyles(e),document.head.appendChild(this.printStyleElement)}removePrintStyles(){this.printStyleElement&&(this.printStyleElement.remove(),this.printStyleElement=null)}createPrintDocument(e,t){const i=this.render(e,t,{scale:1,showPageBorder:!1,showCellBorder:!1});return Object.assign(i.style,{padding:"0",gap:"0",backgroundColor:"transparent"}),i}async print(e,t){var o;const i=document.createElement("iframe");i.style.position="fixed",i.style.right="0",i.style.bottom="0",i.style.width="0",i.style.height="0",i.style.border="none",document.body.appendChild(i);const n=i.contentDocument||((o=i.contentWindow)==null?void 0:o.document);if(!n)throw new Error("Failed to access iframe document");const r=this.createPrintDocument(e,t);return n.open(),n.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="utf-8">
          <title>Photo Print</title>
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            ${this.generatePrintStyles(t)}
          </style>
        </head>
        <body>
          ${r.outerHTML}
        </body>
      </html>
    `),n.close(),await this.waitForImagesToLoad(n),new Promise((a,s)=>{var l,g;(l=i.contentWindow)==null||l.focus();try{(g=i.contentWindow)==null||g.print(),setTimeout(()=>{document.body.removeChild(i),a()},1e3)}catch(d){document.body.removeChild(i),s(d)}})}waitForImagesToLoad(e){const t=e.querySelectorAll("img"),i=Array.from(t).map(n=>n.complete?Promise.resolve():new Promise(r=>{n.onload=()=>r(),n.onerror=()=>r()}));return Promise.all(i).then(()=>{})}destroy(){this.removePrintStyles(),this.container&&(this.container.remove(),this.container=null)}}const E=[{id:"full",name:"Full Page",description:"Single image filling the entire page",grid:{cols:1,rows:1},aspectRatio:void 0,gap:0,orientation:"auto"},{id:"2x1",name:"2-up Horizontal",description:"Two images side by side",grid:{cols:2,rows:1},aspectRatio:1.5,gap:5,orientation:"landscape"},{id:"1x2",name:"2-up Vertical",description:"Two images stacked vertically",grid:{cols:1,rows:2},aspectRatio:.667,gap:5,orientation:"portrait"},{id:"2x2",name:"4-up Grid",description:"Four images in a 2x2 grid",grid:{cols:2,rows:2},aspectRatio:1,gap:5,orientation:"auto"},{id:"2x3",name:"6-up Vertical",description:"Six images in a 2x3 grid",grid:{cols:2,rows:3},aspectRatio:1,gap:4,orientation:"portrait"},{id:"3x2",name:"6-up Horizontal",description:"Six images in a 3x2 grid",grid:{cols:3,rows:2},aspectRatio:1,gap:4,orientation:"landscape"},{id:"3x3",name:"9-up Grid",description:"Nine images in a 3x3 grid (index print)",grid:{cols:3,rows:3},aspectRatio:1,gap:3,orientation:"auto"},{id:"4x4",name:"16-up Grid",description:"Sixteen images in a 4x4 grid (thumbnails)",grid:{cols:4,rows:4},aspectRatio:1,gap:2,orientation:"auto"},{id:"4x5",name:"20-up Contact Sheet",description:"Twenty images in a 4x5 grid (contact sheet)",grid:{cols:4,rows:5},aspectRatio:1.5,gap:2,orientation:"portrait"},{id:"wallet",name:"Wallet Size",description:"Eight wallet-sized photos",grid:{cols:4,rows:2},aspectRatio:.667,gap:3,orientation:"landscape"},{id:"3.5x5",name:"3.5x5 inch",description:"Standard 3.5x5 inch photo size",grid:{cols:2,rows:2},aspectRatio:.7,gap:5,orientation:"portrait"},{id:"4x6",name:"4x6 inch",description:"Standard 4x6 inch photo size",grid:{cols:2,rows:2},aspectRatio:.667,gap:5,orientation:"portrait"},{id:"5x7",name:"5x7 inch",description:"Medium 5x7 inch photo size",grid:{cols:1,rows:2},aspectRatio:.714,gap:5,orientation:"portrait"}],C=[{id:"a4",name:"A4",width:210,height:297},{id:"a5",name:"A5",width:148,height:210},{id:"a3",name:"A3",width:297,height:420},{id:"letter",name:"Letter",width:216,height:279},{id:"legal",name:"Legal",width:216,height:356},{id:"4x6",name:"4x6 inch",width:102,height:152},{id:"5x7",name:"5x7 inch",width:127,height:178}];function D(c){return E.find(e=>e.id===c)}function _(c){return C.find(e=>e.id===c)}const T=E.find(c=>c.id==="2x2"),F=C.find(c=>c.id==="a4"),B={top:10,right:10,bottom:10,left:10},M={fit:"cover",position:{horizontal:"center",vertical:"center"},rotation:0};class N{constructor(e={}){u(this,"imageProcessor");u(this,"layoutEngine");u(this,"domRenderer");u(this,"currentLayout");u(this,"paperSettings");u(this,"imageSettings");u(this,"previewContainer",null);u(this,"previewOptions",null);u(this,"eventListeners",new Map);u(this,"debug");this.debug=e.debug||!1,this.imageProcessor=new O,this.layoutEngine=new A,this.domRenderer=new $,this.currentLayout=this.resolveLayout(e.layout)||T,this.paperSettings=this.resolvePaperSettings(e.paper),this.imageSettings={...M,...e.imageSettings},e.images&&e.images.length>0&&this.addImages(e.images),e.preview&&this.renderPreview(e.preview)}async addImage(e){try{const t=await this.imageProcessor.loadImage(e);return this.emit("imageAdded",{image:t}),this.updatePreviewIfNeeded(),t.id}catch(t){throw this.emit("error",{error:t,source:e}),t}}async addImages(e){const t=[];for(const i of e)try{const n=await this.addImage(i);t.push(n)}catch(n){this.log("Failed to add image:",n)}return t}removeImage(e){const t=this.imageProcessor.getImage(e);t&&(this.imageProcessor.removeImage(e),this.emit("imageRemoved",{id:e,image:t}),this.updatePreviewIfNeeded())}reorderImages(e,t){this.imageProcessor.reorderImages(e,t),this.emit("imagesReordered",{fromIndex:e,toIndex:t}),this.updatePreviewIfNeeded()}clearImages(){this.imageProcessor.clearImages(),this.updatePreviewIfNeeded()}getImages(){return this.imageProcessor.getAllImages()}setLayout(e){const t=this.resolveLayout(e);if(!t)throw new Error(`Layout not found: ${e}`);this.currentLayout=t,this.emit("layoutChanged",{layout:this.currentLayout}),this.updatePreviewIfNeeded()}getLayout(){return{...this.currentLayout}}getAvailableLayouts(){return[...E,...this.layoutEngine.getCustomLayouts()]}registerLayout(e){this.layoutEngine.registerLayout(e)}setPaper(e){const t={size:this.paperSettings.width+"x"+this.paperSettings.height,orientation:this.paperSettings.orientation,margins:this.paperSettings.margins,unit:this.paperSettings.unit},i=I({...t},e);this.paperSettings=this.resolvePaperSettings(i),this.emit("paperChanged",{paper:this.paperSettings}),this.updatePreviewIfNeeded()}getPaper(){return{...this.paperSettings}}setPaperSize(e){this.setPaper({size:e})}setMargins(e){typeof e=="number"?this.setPaper({margins:{top:e,right:e,bottom:e,left:e}}):this.setPaper({margins:{...this.paperSettings.margins,...e}})}setImageSettings(e,t){typeof e=="string"&&t?this.imageProcessor.updateImageSettings(e,t):typeof e=="object"&&(this.imageSettings={...this.imageSettings,...e}),this.emit("settingsChanged",{imageSettings:this.imageSettings}),this.updatePreviewIfNeeded()}getImageSettings(e){if(e){const t=this.imageProcessor.getImage(e);if(t&&t.settings)return{...this.imageSettings,...t.settings}}return{...this.imageSettings}}renderPreview(e){const t=z(e.container);if(!t)throw new Error("Preview container not found");this.previewContainer=t,this.previewOptions=e,this.updatePreview()}updatePreview(){if(!this.previewContainer||!this.previewOptions)return;this.previewContainer.innerHTML="";const e=this.getPages(),t=this.previewContainer.clientWidth||400,i=this.previewContainer.clientHeight||600,n=this.paperSettings.width/this.paperSettings.height,r=t/i;let o;n>r?o=(t-40)/(this.paperSettings.width*3.78):o=(i-40)/(this.paperSettings.height*3.78),o=Math.min(o,1);const a=this.previewOptions.theme==="auto"?"light":this.previewOptions.theme,s=this.domRenderer.render(e,this.getRenderSettings(),{container:this.previewContainer,scale:o,showPageBorder:!0,showCellBorder:!1,theme:a});this.previewContainer.appendChild(s),this.previewOptions.showNavigation&&e.length>1&&this.addPageNavigation(e.length),this.previewOptions.showPageNumber&&this.addPageNumbers(e.length)}destroyPreview(){this.previewContainer&&(this.previewContainer.innerHTML="",this.previewContainer=null,this.previewOptions=null)}updatePreviewIfNeeded(){this.previewContainer&&this.previewOptions&&this.updatePreview()}addPageNavigation(e){if(!this.previewContainer)return;const t=document.createElement("div");t.className="photo-print-navigation",t.style.cssText="display: flex; justify-content: center; gap: 10px; margin-top: 10px;";const i=document.createElement("button");i.textContent="<",i.className="photo-print-nav-btn";const n=document.createElement("span");n.textContent=`1 / ${e}`,n.className="photo-print-page-info";const r=document.createElement("button");r.textContent=">",r.className="photo-print-nav-btn";let o=0;const a=this.previewContainer.querySelectorAll(".photo-print-page"),s=()=>{a.forEach((l,g)=>{l.style.display=g===o?"block":"none"}),n.textContent=`${o+1} / ${e}`};i.onclick=()=>{o=Math.max(0,o-1),s()},r.onclick=()=>{o=Math.min(e-1,o+1),s()},t.appendChild(i),t.appendChild(n),t.appendChild(r),this.previewContainer.appendChild(t),s()}addPageNumbers(e){if(!this.previewContainer)return;this.previewContainer.querySelectorAll(".photo-print-page").forEach((i,n)=>{const r=document.createElement("div");r.className="photo-print-page-number",r.textContent=`${n+1} / ${e}`,r.style.cssText="position: absolute; bottom: 5px; right: 10px; font-size: 12px; color: #666;",i.appendChild(r)})}async print(){this.emit("beforePrint",{});try{const e=this.getPages();await this.domRenderer.print(e,this.getRenderSettings()),this.emit("afterPrint",{success:!0})}catch(e){throw this.emit("afterPrint",{success:!1,error:e}),e}}async toCanvas(e=0){const i=this.getPages()[e];if(!i)throw new Error(`Page ${e} not found`);const r=this.getRenderSettings().dpi||96,o=document.createElement("canvas");o.width=Math.round(this.paperSettings.width*(r/25.4)),o.height=Math.round(this.paperSettings.height*(r/25.4));const a=o.getContext("2d");if(!a)throw new Error("Failed to get canvas context");a.fillStyle="#ffffff",a.fillRect(0,0,o.width,o.height);for(let s=0;s<i.cells.length;s++){const l=i.cells[s],g=i.images[s];if(!g)continue;const d=this.getImageSettings(g.id),p=this.layoutEngine.calculateImageFit(g,l,d.fit,d.position),m=p.x*(r/25.4),y=p.y*(r/25.4),w=p.width*(r/25.4),P=p.height*(r/25.4);if(d.rotation){a.save();const x=m+w/2,S=y+P/2;a.translate(x,S),a.rotate(d.rotation*Math.PI/180),a.drawImage(g.element,-w/2,-P/2,w,P),a.restore()}else a.drawImage(g.element,m,y,w,P)}return o}async toDataURL(e=0,t="png"){return(await this.toCanvas(e)).toDataURL(`image/${t}`,.92)}async toBlob(e=0,t="png"){const i=await this.toCanvas(e);return new Promise((n,r)=>{i.toBlob(o=>{o?n(o):r(new Error("Failed to create blob"))},`image/${t}`,.92)})}getPageCount(){return this.getPages().length}getPageInfo(e){return this.getPages()[e]}getPages(){const e=this.imageProcessor.getAllImages();return this.layoutEngine.calculatePages(e,this.currentLayout,this.paperSettings)}getRenderSettings(){return{paper:this.paperSettings,layout:this.currentLayout,imageSettings:this.imageSettings,dpi:96}}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}off(e,t){var i;t?(i=this.eventListeners.get(e))==null||i.delete(t):this.eventListeners.delete(e)}once(e,t){const i=n=>{this.off(e,i),t(n)};this.on(e,i)}emit(e,t){var n;const i={type:e,data:t,timestamp:Date.now()};(n=this.eventListeners.get(e))==null||n.forEach(r=>{try{r(i)}catch(o){this.log("Event callback error:",o)}})}reset(){this.clearImages(),this.currentLayout=T,this.paperSettings=this.resolvePaperSettings({}),this.imageSettings={...M},this.updatePreviewIfNeeded()}destroy(){this.destroyPreview(),this.clearImages(),this.domRenderer.destroy(),this.eventListeners.clear()}resolveLayout(e){return e?typeof e=="string"?D(e)||this.layoutEngine.getCustomLayout(e)||null:e:null}resolvePaperSettings(e){let t=F.width,i=F.height;if(e!=null&&e.size)if(typeof e.size=="string"){const a=_(e.size);a&&(t=a.width,i=a.height)}else t=e.size.width,i=e.size.height;const n=(e==null?void 0:e.orientation)||"portrait",r=(e==null?void 0:e.unit)||"mm";n==="landscape"&&t<i?[t,i]=[i,t]:n==="portrait"&&t>i&&([t,i]=[i,t]);const o={...B,...e==null?void 0:e.margins};return{width:t,height:i,orientation:n==="auto"?"portrait":n,margins:o,unit:r}}log(...e){this.debug&&console.log("[PhotoPrintLayout]",...e)}static fromImages(e,t="2x2"){return new N({images:e,layout:t})}static getPresetLayouts(){return[...E]}static getPaperSizes(){return[...C]}}return h.DEFAULT_IMAGE_SETTINGS=M,h.DEFAULT_LAYOUT=T,h.DEFAULT_MARGINS=B,h.DEFAULT_PAPER_SIZE=F,h.DOMRenderer=$,h.ImageProcessor=O,h.LayoutEngine=A,h.PRESET_LAYOUTS=E,h.PRESET_PAPER_SIZES=C,h.PhotoPrintLayout=N,h.clamp=Y,h.createElement=Z,h.debounce=q,h.deepMerge=I,h.generateId=v,h.getElement=z,h.getLayoutById=D,h.getPaperSizeById=_,h.inchToMm=G,h.inchToPx=W,h.isBrowser=X,h.mmToInch=j,h.mmToPx=f,h.pxToInch=H,h.pxToMm=U,h.throttle=V,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),h}({});
//# sourceMappingURL=photo-print.iife.js.map
